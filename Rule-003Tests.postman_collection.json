{
  "info": {
    "_postman_id": "d5bf6155-8086-44ca-a55b-0846313663a5",
    "name": "Rule-003 Tests",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Execute Deploy Rule 003",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Content-Type is present\", function () {",
              "    pm.response.to.have.header(\"Content-Type\");",
              "});",
              "",
              "",
              "pm.test(\"use the debtor account information to identify the account\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.transaction.CstmrCdtTrfInitn.PmtInf.DbtrAcct.Id.Othr.SchmeNm.Prtry).to.be.eql('PASSPORT');",
              "    pm.expect(jsonData.transaction.CstmrCdtTrfInitn.PmtInf.DbtrAcct.Id.Othr.Id).to.be.eql('+27783078685');",
              "});",
              "",
              "pm.test(\"use the creditor account information to identify the account\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.transaction.CstmrCdtTrfInitn.PmtInf.CdtTrfTxInf.Cdtr.Id.PrvtId.Othr.SchmeNm.Prtry).to.be.eql('MSISDN');",
              "    pm.expect(jsonData.transaction.CstmrCdtTrfInitn.PmtInf.CdtTrfTxInf.Cdtr.Id.PrvtId.Othr.Id).to.be.eql('+27782722305');",
              "});",
              "",
              "pm.test(\"Check that the payload sent to the Typology processor contains Original transaction, network sub map, rule result\", function () {",
              "    var jsonData = pm.response.json();",
              "",
              "    pm.expect(Object.keys(jsonData)).to.include('transaction', 'networkSubMap, ruleResult');",
              "});",
              "",
              "pm.test(\"Body matches string\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"Result for Rule 003 is false\");",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\r\n    \"transaction\": {\r\n        \"TxTp\": \"pain.001.001.11\",\r\n        \"CstmrCdtTrfInitn\": {\r\n            \"GrpHdr\": {\r\n                \"MsgId\": \"2669e349-500d-44ba-9e27-7767a16608a0\",\r\n                \"CreDtTm\": \"2021-10-07T09:25:31.000Z\",\r\n                \"NbOfTxs\": 1,\r\n                \"InitgPty\": {\r\n                    \"Nm\": \"Ivan Reese Russel-Klein\",\r\n                    \"Id\": {\r\n                        \"PrvtId\": {\r\n                            \"DtAndPlcOfBirth\": {\r\n                                \"BirthDt\": \"1967-11-23\",\r\n                                \"CityOfBirth\": \"Unknown\",\r\n                                \"CtryOfBirth\": \"ZZ\"\r\n                            },\r\n                            \"Othr\": {\r\n                                \"Id\": \"+27783078685\",\r\n                                \"SchmeNm\": {\r\n                                    \"Prtry\": \"MSISDN\"\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n                    \"CtctDtls\": {\r\n                        \"MobNb\": \"+27-783078685\"\r\n                    }\r\n                }\r\n            },\r\n            \"PmtInf\": {\r\n                \"PmtInfId\": \"b51ec534-ee48-4575-b6a9-ead2955b8069\",\r\n                \"PmtMtd\": \"TRA\",\r\n                \"ReqdAdvcTp\": {\r\n                    \"DbtAdvc\": {\r\n                        \"Cd\": \"ADWD\",\r\n                        \"Prtry\": \"Advice with transaction details\"\r\n                    }\r\n                },\r\n                \"ReqdExctnDt\": {\r\n                    \"Dt\": \"2021-10-07\",\r\n                    \"DtTm\": \"2021-10-07T09:25:31.000Z\"\r\n                },\r\n                \"Dbtr\": {\r\n                    \"Nm\": \"Ivan Reese Russel-Klein\",\r\n                    \"Id\": {\r\n                        \"PrvtId\": {\r\n                            \"DtAndPlcOfBirth\": {\r\n                                \"BirthDt\": \"1957-10-05\",\r\n                                \"CityOfBirth\": \"Unknown\",\r\n                                \"CtryOfBirth\": \"ZZ\"\r\n                            },\r\n                            \"Othr\": {\r\n                                \"Id\": \"+27783078685\",\r\n                                \"SchmeNm\": {\r\n                                    \"Prtry\": \"MSISDN\"\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n                    \"CtctDtls\": {\r\n                        \"MobNb\": \"+27-783078685\"\r\n                    }\r\n                },\r\n                \"DbtrAcct\": {\r\n                    \"Id\": {\r\n                        \"Othr\": {\r\n                            \"Id\": \"+27783078685\",\r\n                            \"SchmeNm\": {\r\n                                \"Prtry\": \"PASSPORT\"\r\n                            }\r\n                        }\r\n                    },\r\n                    \"Nm\": \"Ivan Russel-Klein\"\r\n                },\r\n                \"DbtrAgt\": {\r\n                    \"FinInstnId\": {\r\n                        \"ClrSysMmbId\": {\r\n                            \"MmbId\": \"dfsp001\"\r\n                        }\r\n                    }\r\n                },\r\n                \"CdtTrfTxInf\": {\r\n                    \"PmtId\": {\r\n                        \"EndToEndId\": \"b51ec534-ee48-4575-b6a9-ead2955b8069\"\r\n                    },\r\n                    \"PmtTpInf\": {\r\n                        \"CtgyPurp\": {\r\n                            \"Prtry\": \"TRANSFER\"\r\n                        }\r\n                    },\r\n                    \"Amt\": {\r\n                        \"InstdAmt\": {\r\n                            \"Amt\": {\r\n                                \"Amt\": \"50431891779910900\",\r\n                                \"Ccy\": \"USD\"\r\n                            }\r\n                        },\r\n                        \"EqvtAmt\": {\r\n                            \"Amt\": {\r\n                                \"Amt\": \"50431891779910900\",\r\n                                \"Ccy\": \"USD\"\r\n                            },\r\n                            \"CcyOfTrf\": \"USD\"\r\n                        }\r\n                    },\r\n                    \"ChrgBr\": \"DEBT\",\r\n                    \"CdtrAgt\": {\r\n                        \"FinInstnId\": {\r\n                            \"ClrSysMmbId\": {\r\n                                \"MmbId\": \"dfsp002\"\r\n                            }\r\n                        }\r\n                    },\r\n                    \"Cdtr\": {\r\n                        \"Nm\": \"April Sam Adamson\",\r\n                        \"Id\": {\r\n                            \"PrvtId\": {\r\n                                \"DtAndPlcOfBirth\": {\r\n                                    \"BirthDt\": \"1923-04-26\",\r\n                                    \"CityOfBirth\": \"Unknown\",\r\n                                    \"CtryOfBirth\": \"ZZ\"\r\n                                },\r\n                                \"Othr\": {\r\n                                    \"Id\": \"+27782722305\",\r\n                                    \"SchmeNm\": {\r\n                                        \"Prtry\": \"MSISDN\"\r\n                                    }\r\n                                }\r\n                            }\r\n                        },\r\n                        \"CtctDtls\": {\r\n                            \"MobNb\": \"+27-782722305\"\r\n                        }\r\n                    },\r\n                    \"CdtrAcct\": {\r\n                        \"Id\": {\r\n                            \"Othr\": {\r\n                                \"Id\": \"+27783078685\",\r\n                                \"SchmeNm\": {\r\n                                    \"Prtry\": \"MSISDN\"\r\n                                }\r\n                            }\r\n                        },\r\n                        \"Nm\": \"April Adamson\"\r\n                    },\r\n                    \"Purp\": {\r\n                        \"Cd\": \"MP2P\"\r\n                    },\r\n                    \"RgltryRptg\": {\r\n                        \"Dtls\": {\r\n                            \"Tp\": \"BALANCE OF PAYMENTS\",\r\n                            \"Cd\": \"100\"\r\n                        }\r\n                    },\r\n                    \"RmtInf\": {\r\n                        \"Ustrd\": \"Payment of USD 49932566118723700.89 from Ivan to April\"\r\n                    },\r\n                    \"SplmtryData\": {\r\n                        \"Envlp\": {\r\n                            \"Doc\": {\r\n                                \"Cdtr\": {\r\n                                    \"FrstNm\": \"Ivan\",\r\n                                    \"MddlNm\": \"Reese\",\r\n                                    \"LastNm\": \"Russel-Klein\",\r\n                                    \"MrchntClssfctnCd\": \"BLANK\"\r\n                                },\r\n                                \"Dbtr\": {\r\n                                    \"FrstNm\": \"April\",\r\n                                    \"MddlNm\": \"Sam\",\r\n                                    \"LastNm\": \"Adamson\",\r\n                                    \"MrchntClssfctnCd\": \"BLANK\"\r\n                                },\r\n                                \"DbtrFinSvcsPrvdrFees\": {\r\n                                    \"Ccy\": \"USD\",\r\n                                    \"Amt\": \"499325661187237\"\r\n                                },\r\n                                \"Xprtn\": \"2021-10-07T09:30:31.000Z\"\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n            \"SplmtryData\": {\r\n                \"Envlp\": {\r\n                    \"Doc\": {\r\n                        \"InitgPty\": {\r\n                            \"InitrTp\": \"CONSUMER\",\r\n                            \"Glctn\": {\r\n                                \"Lat\": \"-3.1291\",\r\n                                \"Long\": \"39.0006\"\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n    \"networkMap\": {\r\n        \"_key\": \"26345403\",\r\n        \"_id\": \"networkConfiguration/26345403\",\r\n        \"_rev\": \"_cxc-1vO---\",\r\n        \"messages\": [\r\n            {\r\n                \"id\": \"001@1.0\",\r\n                \"host\": \"http://openfaas:8080\",\r\n                \"cfg\": \"1.0\",\r\n                \"txTp\": \"pain.001.001.11\",\r\n                \"channels\": [\r\n                    {\r\n                        \"id\": \"001@1.0\",\r\n                        \"host\": \"http://openfaas:8080\",\r\n                        \"cfg\": \"1.0\",\r\n                        \"typologies\": [\r\n                            {\r\n                                \"id\": \"028@1.0\",\r\n                                \"host\": \"https://frmfaas.sybrin.com/function/off-frm-typology-processor\",\r\n                                \"cfg\": \"028@1.0\",\r\n                                \"rules\": [\r\n                                    {\r\n                                        \"id\": \"003@1.0\",\r\n                                        \"host\": \"http://openfaas:8080\",\r\n                                        \"cfg\": \"1.0\"\r\n                                    },\r\n                                    {\r\n                                        \"id\": \"028@1.0\",\r\n                                        \"host\": \"http://openfaas:8080\",\r\n                                        \"cfg\": \"1.0\"\r\n                                    }\r\n                                ]\r\n                            },\r\n                            {\r\n                                \"id\": \"029@1.0\",\r\n                                \"host\": \"https://frmfaas.sybrin.com/function/off-frm-typology-processor\",\r\n                                \"cfg\": \"029@1.0\",\r\n                                \"rules\": [\r\n                                    {\r\n                                        \"id\": \"003@1.0\",\r\n                                        \"host\": \"http://openfaas:8080\",\r\n                                        \"cfg\": \"1.0\"\r\n                                    },\r\n                                    {\r\n                                        \"id\": \"005@1.0\",\r\n                                        \"host\": \"http://openfaas:8080\",\r\n                                        \"cfg\": \"1.0\"\r\n                                    }\r\n                                ]\r\n                            }\r\n                        ]\r\n                    },\r\n                    {\r\n                        \"id\": \"002@1.0\",\r\n                        \"host\": \"http://openfaas:8080\",\r\n                        \"cfg\": \"1.0\",\r\n                        \"typologies\": [\r\n                            {\r\n                                \"id\": \"030@1.0\",\r\n                                \"host\": \"https://frmfaas.sybrin.com/function/off-frm-typology-processor\",\r\n                                \"cfg\": \"030@1.0\",\r\n                                \"rules\": [\r\n                                    {\r\n                                        \"id\": \"003@1.0\",\r\n                                        \"host\": \"http://openfaas:8080\",\r\n                                        \"cfg\": \"1.0\"\r\n                                    },\r\n                                    {\r\n                                        \"id\": \"006@1.0\",\r\n                                        \"host\": \"http://openfaas:8080\",\r\n                                        \"cfg\": \"1.0\"\r\n                                    }\r\n                                ]\r\n                            },\r\n                            {\r\n                                \"id\": \"031@1.0\",\r\n                                \"host\": \"https://frmfaas.sybrin.com/function/off-frm-typology-processor\",\r\n                                \"cfg\": \"031@1.0\",\r\n                                \"rules\": [\r\n                                    {\r\n                                        \"id\": \"003@1.0\",\r\n                                        \"host\": \"http://openfaas:8080\",\r\n                                        \"cfg\": \"1.0\"\r\n                                    },\r\n                                    {\r\n                                        \"id\": \"007@1.0\",\r\n                                        \"host\": \"http://openfaas:8080\",\r\n                                        \"cfg\": \"1.0\"\r\n                                    }\r\n                                ]\r\n                            }\r\n                        ]\r\n                    }\r\n                ]\r\n            }\r\n        ]\r\n    }\r\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "https://frmfaas.sybrin.com/function/off-rule-003.openfaas-fn/execute",
          "protocol": "http",
          "host": ["gateway", "openfaas"],
          "port": "8080",
          "path": ["function", "off-rule-003.openfaas-fn", "execute"]
        }
      },
      "response": []
    }
  ]
}
